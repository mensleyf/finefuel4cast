# ----------------------- packges, fncs----------------------
if (!require("pacman")) install.packages("pacman"); library(pacman)
p_load(rstan,dplyr,tidyr,shinystan,here,rstudioapi,readtext,  install = TRUE, update = getOption("pac_update"), character.only = FALSE)
current_path <-getActiveDocumentContext()$path
BL_folder<-paste0("G:/My Drive/finefuel4cast/Fuels_model/Bayesian_Land/")
# source(file = paste0(BL_folder,"/f3_functions.R"))
# source(file = paste0(BL_folder,"/subset_Scripts/raw_hi_dens_subset.R"))
# source(file = paste0(BL_folder,"/dev_fast_configuring.R"))
# ----------------------- data ----------------------
real_data<-readRDS("G:/My Drive/finefuel4cast/Fuels_model/Bayesian_Land/stan_model_scripts/stan_data/newest_data_list.rds")
prod_data<-real_data$raw_prod_all[,11:35]
fuel_data<-real_data$raw_fuel_obs_all[,1:25]
fuel_data_dev<-matrix(NA,ncol=ncol(fuel_data_orig), nrow=nrow(fuel_data_orig))
prod_data_dev<-matrix(NA,ncol=ncol(prod_data_orig), nrow=nrow(prod_data_orig))
fuel_data_z<-matrix(NA,ncol=ncol(fuel_data_orig), nrow=nrow(fuel_data_orig))
prod_data_z<-matrix(NA,ncol=ncol(prod_data_orig), nrow=nrow(prod_data_orig))
for(i in 1:nrow(fuel_data_dev)){
fuel_data_dev[i,]<-fuel_data_orig[i,]-mean(fuel_data_orig[i,],na.rm=TRUE)
prod_data_dev[i,]<-prod_data_orig[i,]-mean(prod_data_orig[i,])
fuel_data_z[i,]<-(fuel_data_orig[i,]-mean(fuel_data_orig[i,],na.rm=TRUE))/sd(fuel_data_orig[i,],na.rm=TRUE)
prod_data_z[i,]<-(prod_data_orig[i,]-mean(prod_data_orig[i,]))/sd(prod_data_orig[i,])
}
sample_data<-real_data$samp
field_office_data<-real_data$field_off_all
fo_cols<-as.data.frame(unique(field_office_data$field_office))
names(fo_cols)<-"fo"
fo_cols$col[fo_cols$fo=="Saddle_Mountain(sageSTEP)"]<-"cyan4"
fo_cols$col[fo_cols$fo=="Onaqui(sageSTEP)"]<-"dodgerblue4"
fo_cols$col[fo_cols$fo=="Moses_Coulee (sageSTEP)"]<-"royalblue1"
fo_cols$col[fo_cols$fo=="Owyhee (sageSTEP)"]<-"steelblue1"
fo_cols$col[fo_cols$fo=="Salt_Lake_City"]<-"plum3"
fo_cols$col[fo_cols$fo=="Fillmore"]<-"orchid1"
fo_cols$col[fo_cols$fo=="Tule_Desert"]<-"goldenrod3"
fo_cols$col[fo_cols$fo=="North_Ely"]<-"darkorange1"
fo_cols$col[fo_cols$fo=="Winnemucca"]<-"gold2"
fo_cols$col[fo_cols$fo=="Mount_Lewis"]<-"burlywood3"
fo_cols$col[fo_cols$fo=="Elko"]<-"burlywood1"
fo_cols$col[fo_cols$fo=="Tonopah"]<-"peachpuff2"
fo_cols$col[fo_cols$fo=="Southern_Nevada"]<-"tan1"
fo_cols$col[fo_cols$fo=="Arizona_Strip"]<-"red"
fo_cols$col[fo_cols$fo=="Twin_Falls"]<-"palegreen"
fo_cols$col[fo_cols$fo=="Upper_Snake"]<-"seagreen"
fo_cols$col[fo_cols$fo=="Pocatello"]<-"mediumseagreen"
fo_cols$col[fo_cols$fo=="Boise"]<-"forestgreen"
names(fo_cols)<-c("field_office", "col")
field_office_data<-plyr::join(field_office_data, fo_cols)
site_names<-real_data$site_names_all
ratio<-matrix(NA,nrow=198, ncol=25)
field_office_m<-matrix(NA,nrow=198, ncol=25)
fuel_data<-replace(fuel_data, fuel_data==0, .01)
for (i in 1:nrow(ratio)){
ratio[i,]<-(fuel_data[i,]/prod_data[i,])
field_office_m[i,]<-rep(field_office_data$col[i], 25)
}
##--plot 1##
plot(x=as.vector(prod_data), y=as.vector(fuel_data), col=field_office_m, pch=19,
main="Ratio of Fine Fuel and RAP productivity data",
ylab="obs fine fuels (lbs/acre)", xlab= "RAP productivity (lbs/acre)")
abline(0,1)
#systematic
ratio_row<-rowMeans(ratio,na.rm=T)
ratio_f<-rowMeans(ratio,na.rm=T)
ratio_row<-rowMeans(ratio,na.rm=T)
ratio_site<-as.data.frame(cbind(ratio_row,rowMeans(fuel_data,na.rm=T),rowMeans(prod_data,na.rm=T), field_office_data, site_names))
names(ratio_site)<-c("ratio", "fuel", "prod", "field_off", "field_off_fact","col", "site")
##--plot 1##
plot(y=ratio_site$fuel, x=ratio_site$prod, col=ratio_site$col, pch=19,
main="Ratio of Fine Fuel and RAP productivity data by site",
ylab="site mean obs fine fuels (lbs/acre)", xlab= "site mean RAP productivity (lbs/acre)")
abline(0,1)
# View(ratio_site)
ratio_fo<-ratio_site %>%
dplyr::group_by(field_off) %>%
dplyr::mutate(ratio_fo=mean(ratio, na.rm=T),
prod_fo=mean(prod,na.rm=T),
fuel_fo=mean(fuel,na.rm=T))
text_names<-ratio_fo$field_off
fo_cols$col[fo_cols$fo=="Saddle_Mountain(sageSTEP)"]<-"cyan4"
fo_cols$col[fo_cols$fo=="Onaqui(sageSTEP)"]<-"dodgerblue4"
fo_cols$col[fo_cols$fo=="Moses_Coulee (sageSTEP)"]<-"royalblue1"
fo_cols$col[fo_cols$fo=="Owyhee (sageSTEP)"]<-"steelblue1"
text_names<-replace(text_names, text_names=="Saddle_Mountain(sageSTEP)", "Saddle Mountain")
text_names<-replace(text_names, text_names=="Onaqui(sageSTEP)", "Onaqui")
text_names<-replace(text_names, text_names=="Moses_Coulee (sageSTEP)", "Moses Coulee")
text_names<-replace(text_names, text_names=="Owyhee (sageSTEP)", "Owyhee")
text_pos<-rep(4,198)
text_pos[text_names=="Winnemucca"]<-2
text_pos[text_names=="Boise"]<-2
text_pos[text_names=="Moses Coulee"]<-3
text_pos[text_names=="Tule_Desert"]<-1
plot(y=ratio_fo$fuel_fo, x=ratio_fo$prod_fo, col=ratio_fo$col, pch=19,
main="Ratio of Fine Fuel and RAP productivity data by field office",
ylab="field office mean obs fine fuels (lbs/acre)", xlab= "field office mean RAP productivity (lbs/acre)")
text(y=ratio_fo$fuel_fo,x= ratio_fo$prod_fo, labels=text_names, pos=text_pos, col=ratio_fo$col)
abline(0,1)
#custom coolors and labels
hist(ratio,breaks=200,xlim=c(0,50), main="Fuel:Productivity Ratio Frequency",probability=T, xlab="fuel:productivity ratio")
View(as.data.frame(as.vector(ratio)))
# View(as.data.frame(na.omit(as.vector(ratio))))
ratio_row<-rowMeans(ratio,na.rm=T)
ratio_f<-rowMeans(ratio,na.rm=T)
ratio_row<-rowMeans(ratio,na.rm=T)
ratio_site<-as.data.frame(cbind(ratio_row,rowMeans(fuel_data,na.rm=T),rowMeans(prod_data,na.rm=T), field_office_data, site_names))
names(ratio_site)<-c("ratio", "fuel", "prod", "field_off", "field_off_fact","col", "site")
##--plot 1##
plot(y=ratio_site$fuel, x=ratio_site$prod, col=ratio_site$col, pch=19,
main="Ratio of Fine Fuel and RAP productivity data by site",
ylab="site mean obs fine fuels (lbs/acre)", xlab= "site mean RAP productivity (lbs/acre)")
abline(0,1)
ratio_fo<-ratio_site %>%
dplyr::group_by(field_off) %>%
dplyr::mutate(ratio_fo=mean(ratio, na.rm=T),
prod_fo=mean(prod,na.rm=T),
fuel_fo=mean(fuel,na.rm=T))
text_names<-ratio_fo$field_off
fo_cols$col[fo_cols$fo=="Saddle_Mountain(sageSTEP)"]<-"cyan4"
fo_cols$col[fo_cols$fo=="Onaqui(sageSTEP)"]<-"dodgerblue4"
fo_cols$col[fo_cols$fo=="Moses_Coulee (sageSTEP)"]<-"royalblue1"
fo_cols$col[fo_cols$fo=="Owyhee (sageSTEP)"]<-"steelblue1"
text_names<-replace(text_names, text_names=="Saddle_Mountain(sageSTEP)", "Saddle Mountain")
text_names<-replace(text_names, text_names=="Onaqui(sageSTEP)", "Onaqui")
text_names<-replace(text_names, text_names=="Moses_Coulee (sageSTEP)", "Moses Coulee")
text_names<-replace(text_names, text_names=="Owyhee (sageSTEP)", "Owyhee")
text_pos<-rep(4,198)
text_pos[text_names=="Winnemucca"]<-2
text_pos[text_names=="Boise"]<-2
text_pos[text_names=="Moses Coulee"]<-3
text_pos[text_names=="Tule_Desert"]<-1
plot(y=ratio_fo$fuel_fo, x=ratio_fo$prod_fo, col=ratio_fo$col, pch=19,
main="Ratio of Fine Fuel and RAP productivity data by field office",
ylab="field office mean obs fine fuels (lbs/acre)", xlab= "field office mean RAP productivity (lbs/acre)")
text(y=ratio_fo$fuel_fo,x= ratio_fo$prod_fo, labels=text_names, pos=text_pos, col=ratio_fo$col)
abline(0,1)
hist(ratio,breaks=200,xlim=c(0,50), main="Fuel:Productivity Ratio Frequency",probability=T, xlab="fuel:productivity ratio")
View(as.data.frame(as.vector(ratio)))
# ----------------------- data ----------------------
real_data<-readRDS("G:/My Drive/finefuel4cast/Fuels_model/Bayesian_Land/stan_model_scripts/stan_data/newest_data_list.rds")
prod_data<-real_data$raw_prod_all[,11:35]
fuel_data<-real_data$raw_fuel_obs_all[,1:25]
fuel_data_dev<-matrix(NA,ncol=ncol(fuel_data_orig), nrow=nrow(fuel_data_orig))
prod_data_dev<-matrix(NA,ncol=ncol(prod_data_orig), nrow=nrow(prod_data_orig))
fuel_data_z<-matrix(NA,ncol=ncol(fuel_data_orig), nrow=nrow(fuel_data_orig))
prod_data_z<-matrix(NA,ncol=ncol(prod_data_orig), nrow=nrow(prod_data_orig))
for(i in 1:nrow(fuel_data_dev)){
fuel_data_dev[i,]<-fuel_data_orig[i,]-mean(fuel_data_orig[i,],na.rm=TRUE)
prod_data_dev[i,]<-prod_data_orig[i,]-mean(prod_data_orig[i,])
fuel_data_z[i,]<-(fuel_data_orig[i,]-mean(fuel_data_orig[i,],na.rm=TRUE))/sd(fuel_data_orig[i,],na.rm=TRUE)
prod_data_z[i,]<-(prod_data_orig[i,]-mean(prod_data_orig[i,]))/sd(prod_data_orig[i,])
}
sample_data<-real_data$samp
field_office_data<-real_data$field_off_all
fo_cols<-as.data.frame(unique(field_office_data$field_office))
names(fo_cols)<-"fo"
fo_cols$col[fo_cols$fo=="Saddle_Mountain(sageSTEP)"]<-"cyan4"
fo_cols$col[fo_cols$fo=="Onaqui(sageSTEP)"]<-"dodgerblue4"
fo_cols$col[fo_cols$fo=="Moses_Coulee (sageSTEP)"]<-"royalblue1"
fo_cols$col[fo_cols$fo=="Owyhee (sageSTEP)"]<-"steelblue1"
fo_cols$col[fo_cols$fo=="Salt_Lake_City"]<-"plum3"
fo_cols$col[fo_cols$fo=="Fillmore"]<-"orchid1"
fo_cols$col[fo_cols$fo=="Tule_Desert"]<-"goldenrod3"
fo_cols$col[fo_cols$fo=="North_Ely"]<-"darkorange1"
fo_cols$col[fo_cols$fo=="Winnemucca"]<-"gold2"
fo_cols$col[fo_cols$fo=="Mount_Lewis"]<-"burlywood3"
fo_cols$col[fo_cols$fo=="Elko"]<-"burlywood1"
fo_cols$col[fo_cols$fo=="Tonopah"]<-"peachpuff2"
fo_cols$col[fo_cols$fo=="Southern_Nevada"]<-"tan1"
fo_cols$col[fo_cols$fo=="Arizona_Strip"]<-"red"
fo_cols$col[fo_cols$fo=="Twin_Falls"]<-"palegreen"
fo_cols$col[fo_cols$fo=="Upper_Snake"]<-"seagreen"
fo_cols$col[fo_cols$fo=="Pocatello"]<-"mediumseagreen"
fo_cols$col[fo_cols$fo=="Boise"]<-"forestgreen"
names(fo_cols)<-c("field_office", "col")
field_office_data<-plyr::join(field_office_data, fo_cols)
site_names<-real_data$site_names_all
ratio<-matrix(NA,nrow=198, ncol=25)
field_office_m<-matrix(NA,nrow=198, ncol=25)
fuel_data<-replace(fuel_data, fuel_data==0, .01)
for (i in 1:nrow(ratio)){
ratio[i,]<-(fuel_data[i,]/prod_data[i,])
field_office_m[i,]<-rep(field_office_data$col[i], 25)
}
##--plot 1##
plot(x=as.vector(prod_data), y=as.vector(fuel_data), col=field_office_m, pch=19,
main="Ratio of Fine Fuel and RAP productivity data",
ylab="obs fine fuels (lbs/acre)", xlab= "RAP productivity (lbs/acre)")
abline(0,1)
mean(fuel_data/prod_data)
mean(fuel_data/prod_data, na.rm=T)
sum(prod_Data==0)
sum(prod_data==0)
prod_data2<-replace(prod_data, prod_data==0, NA)
mean(fuel_data/prod_data, na.rm=T)
mean(fuel_data/prod_data2, na.rm=T)
